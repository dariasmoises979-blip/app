permissions:
  actions: read
  contents: write
  pull-requests: write
  security-events: write

name: Run Qa Tests

on:
  push:
    branches:
      - qa      
  # ───────────────────────────────────────────────────────────
  # Job 1: Ejecutar tests 
  # ───────────────────────────────────────────────────────────
jobs:
  test:
    name: Run Qa Tests
    uses: dariasmoises979-blip/pipeline-build/.github/workflows/qa.yml@main
    with:
      branch: "qa"
    
      

 # ───────────────────────────────────────────────────────────
 # Job 2: Análisis con SonarCloud
 # ───────────────────────────────────────────────────────────
  sonar-analysis:
    name: Analizar con SonarCloud
    uses: SonarSource/sonarcloud-github-action@v2
    with:
      projectBaseDir: ${{ inputs.projectBaseDir }}
      args: ${{ inputs.sonar_args }}
    env:
      SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      SONAR_HOST_URL: https://sonarcloud.io
  
  
  # ───────────────────────────────────────────────────────────
  # Job 3: Crear PR a Integration
  # ───────────────────────────────────────────────────────────
  create-pr-to-integration:
    name: Create PR to Integration
    needs: test  # ⚙️ Solo se ejecuta si los tests pasan
    uses: dariasmoises979-blip/pipeline-build/.github/workflows/pull-request.yml@main  # 📂 Ruta al workflow reusable
    with:
      source_branch: 'qa'                    # Desde qa
      target_branch: 'integration'                     # Hacia integration
      pr_title: '🚀 Deploy qa to integration'
      environment: 'integration'
      labels: 'automated,deployment,integration,qa'


   
