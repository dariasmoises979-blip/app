permissions:
  actions: read
  contents: read
  security-events: write
  pull-requests: write


name: Run Qa Tests

on:
  push:
    branches:
      - qa      

jobs:
  test:
    name: Run Qa Tests
    uses: dariasmoises979-blip/pipeline-build/.github/workflows/qa.yml@main
    #with:
    #  sonar-token: ${{ secrets.SONAR_TOKEN }}
    #  branch: "qa"


  create-pr:
      name: Create Pull Request for QA Approval
      needs: test
      runs-on: ubuntu-latest
  
      steps:
        - name: Checkout repository
          uses: actions/checkout@v4
          with:
            fetch-depth: 0  # Necesario para crear el PR correctamente
  
        - name: Create Pull Request
          uses: peter-evans/create-pull-request@v6
          with:
            token: ${{ secrets.GH_TOKEN }}
            branch: qa                # Rama origen
            base: main                # Rama destino
            title: "QA Approval Request - $(date +'%Y-%m-%d')"
            body: |
              ðŸš€ Los tests en QA han finalizado correctamente.
  
              Por favor, revisa y aprueba este PR para mergear los cambios a **main**.
            draft: false
            delete-branch: false